<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ºåŒ—é¦¬æ‹‰æ¾æˆ°ç•¥é…é€Ÿç”Ÿæˆå™¨</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #f59e0b;
            --bg: #f3f4f6;
            --text: #1f2937;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        h1 {
            color: var(--secondary);
            margin: 0 0 0.5rem 0;
            font-size: 1.8rem;
        }

        p.subtitle {
            color: #6b7280;
            margin: 0;
            font-size: 0.95rem;
        }

        .input-section {
            background: #eff6ff;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
            border: 1px solid #dbeafe;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        label {
            font-weight: 600;
            color: var(--secondary);
        }

        /* Revised Time Input Styling */
        .time-inputs {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        input[type="number"] {
            font-size: 1.5rem;
            padding: 0.5rem;
            width: 80px;
            text-align: center;
            border: 2px solid var(--primary);
            border-radius: 8px;
            color: var(--text);
            background: white;
            font-family: monospace;
        }

        .time-separator {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
        }

        .unit-label {
            font-size: 0.9rem;
            color: #4b5563;
        }

        button.generate-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }

        button.generate-btn:hover {
            background-color: var(--secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3);
        }

        /* Map Section */
        .map-section {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .map-section h3 {
            margin-top: 0;
            color: #475569;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .map-section img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #cbd5e1;
        }

        /* Results Area */
        #resultArea {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .summary-box {
            background: #fff;
            border-left: 4px solid var(--accent);
            padding: 1rem;
            margin-bottom: 1.5rem;
            background-color: #fffbeb;
        }

        /* Strategy Cards */
        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-left: 5px solid var(--primary);
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
            position: relative;
        }

        .card.wind { border-left-color: #ef4444; background-color: #fef2f2; }
        .card.push { border-left-color: #10b981; background-color: #ecfdf5; }
        .card.warmup { border-left-color: #6366f1; background-color: #eef2ff; }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .card h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #111827;
        }

        .pace-badge {
            background: #1f2937;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.85rem;
            font-weight: 700;
            font-family: monospace;
        }

        .instruction {
            font-size: 0.95rem;
            color: #4b5563;
            margin-bottom: 0.5rem;
        }

        .mantra {
            display: block;
            font-style: italic;
            color: #6b7280;
            font-weight: 500;
            font-size: 0.9rem;
            border-top: 1px dashed #e5e7eb;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }

        .icon { margin-right: 0.5rem; }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 2rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background-color: #f9fafb;
            color: #374151;
            font-weight: 600;
        }

        tr:last-child td { border-bottom: none; }

        /* Print Button & Controls */
        .print-area-wrapper {
            margin-top: 2rem;
            text-align: center;
            padding: 2rem;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px dashed #cbd5e1;
        }

        .print-controls {
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            color: #4b5563;
            user-select: none;
        }

        .checkbox-label input {
            width: 1.2rem;
            height: 1.2rem;
            accent-color: var(--primary);
            cursor: pointer;
        }
        
        .font-settings-container {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .font-settings-title {
            font-size: 0.9rem;
            font-weight: bold;
            color: #475569;
            margin-bottom: 10px;
            text-align: center;
            cursor: pointer;
            user-select: none;
        }
        
        .font-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            display: none; /* Hidden by default */
        }
        
        .font-settings-grid.show {
            display: grid;
        }

        .font-control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .font-control-item label {
            font-size: 0.8rem;
            color: #64748b;
        }
        
        .font-control-item div {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .font-control-item input[type="range"] {
            flex-grow: 1;
        }
        
        .font-control-item span {
            font-size: 0.8rem;
            color: #333;
            width: 35px;
            text-align: right;
        }

        /* Custom Input Fields for Wristband */
        .custom-text-inputs {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .custom-text-inputs input,
        .custom-text-inputs textarea {
            width: 100%;
            font-size: 1rem;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: left;
            font-family: inherit;
        }
        
        .custom-text-inputs textarea {
            resize: vertical;
            min-height: 60px;
        }

        .print-btn {
            background-color: #374151;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.2s;
        }

        .print-btn:hover { background-color: #111827; }

        /* --- WRISTBAND STYLES (SHARED FOR PREVIEW & PRINT) --- */
        .wristband-preview-container {
            margin: 30px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .wristband {
            width: 75mm;
            box-sizing: border-box;
            border: 3px solid #000;
            font-family: "Arial Narrow", "Helvetica Condensed", "Helvetica", sans-serif;
            color: black;
            background: white;
            overflow: hidden; 
        }

        .wb-header {
            background: black;
            color: white;
            text-align: center;
            padding: 2px 0;
            font-weight: 900;
            font-size: 14pt;
            line-height: 1.1;
            text-transform: uppercase;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .wb-goal {
            text-align: center;
            border-bottom: 3px solid black;
            padding: 2px 0;
            font-weight: 900;
            font-size: 18pt;
            line-height: 1.1;
        }

        .wb-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; 
        }

        .wb-table th {
            border-bottom: 2px solid black;
            padding: 2px;
            text-align: center;
            background: #333; 
            color: white;
            font-weight: bold;
            font-size: 10pt;
            white-space: nowrap;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .wb-table tr:nth-child(even) td {
            background-color: #e5e5e5;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .wb-table tr:nth-child(odd) td {
            background-color: #fff;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .wb-table tr.wb-highlight td {
            background-color: #999 !important; 
            color: white;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .wb-table td {
            border-bottom: 1px solid #000;
            border-right: 1px solid #000;
            padding: 1px 2px;
            white-space: nowrap; 
            overflow: hidden;
            font-weight: 800; 
            font-size: 11pt; /* Default, overridden by styles */
            line-height: 1.2;
            text-align: center;
            vertical-align: middle;
        }

        .wb-table td:last-child {
            border-right: none;
        }

        /* DYNAMIC COLUMN STYLES */
        
        .wb-km { 
            width: 12%; 
            font-size: 11pt;
        }
        .wb-phase { 
            width: auto; 
            text-align: left;
            padding-left: 2px;
            text-overflow: ellipsis;
            font-size: 8pt;
        }
        .wb-pace { 
            width: 25%; 
            font-weight: 900;
            font-size: 14pt;
        }
        .wb-seg { 
            width: auto; 
            font-weight: normal;
            font-size: 9pt;
        }
        .wb-time { 
            width: auto; 
            text-align: right;
            padding-right: 4px;
            font-size: 13pt;
        }

        .wb-footer {
            padding: 4px;
            text-align: center;
            font-size: 9pt;
            font-weight: bold;
            border-top: 3px solid black;
            line-height: 1.1;
            background: #fff;
        }

        .wb-custom-text {
            font-style: italic;
            font-size: 10pt;
            margin-top: 2px;
            display: block;
        }
        
        .wb-note-text {
             font-size: 9pt;
             display: block;
             margin-top: 2px;
             color: #444;
             white-space: pre-wrap; /* Allows multiline */
             text-align: left; /* Changed alignment to left */
        }

        /* Hiding Logic */
        .wristband.no-km .wb-km { display: none !important; }
        .wristband.no-phase .wb-phase { display: none !important; }
        .wristband.no-pace .wb-pace { display: none !important; }
        .wristband.no-seg .wb-seg { display: none !important; }
        .wristband.no-time .wb-time { display: none !important; }

        /* PRINT MEDIA QUERY */
        @media print {
            @page {
                margin: 0;
                size: auto; 
            }

            html, body {
                height: 100%;
                margin: 0 !important;
                padding: 0 !important;
                overflow: hidden; 
            }

            body * {
                visibility: hidden;
            }

            #wristbandPreview, #wristbandPreview * {
                visibility: visible;
            }

            #wristbandPreview {
                position: absolute;
                left: 10mm;
                top: 10mm;
                width: auto;
                height: auto;
                margin: 0;
                display: block; 
            }
            
            .wristband {
                margin: 0;
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ‡¹ğŸ‡¼ è‡ºåŒ—é¦¬æ‹‰æ¾æˆ°ç•¥é…é€Ÿ</h1>
        <p class="subtitle">åŸºæ–¼é¢¨é˜»èˆ‡åœ°å½¢çš„å°åŒ—é¦¬æ‹‰æ¾å®Œè³½ç­–ç•¥ç”Ÿæˆå™¨</p>
    </header>

    <div class="input-section">
        <label style="display:block; margin-bottom: 10px;">è«‹è¼¸å…¥æ‚¨çš„ç›®æ¨™å®Œè³½æ™‚é–“ (HH:MM)</label>
        <div class="input-wrapper">
            <div class="time-inputs">
                <input type="number" id="targetHours" value="3" min="1" max="6" placeholder="3">
                <span class="unit-label">æ™‚</span>
                <span class="time-separator">:</span>
                <input type="number" id="targetMinutes" value="29" min="0" max="59" placeholder="30">
                <span class="unit-label">åˆ†</span>
            </div>
            <button class="generate-btn" onclick="calculateStrategy()">ç”Ÿæˆç­–ç•¥</button>
        </div>
        <p style="margin-top: 10px; font-size: 0.85rem; color: #666;">é è¨­ç‚º 3 å°æ™‚ 29 åˆ† (Sub 3:30 ç·©è¡æ™‚é–“)</p>
    </div>

    <!-- Map Section -->
    <div class="map-section">
        <h3>ğŸ—ºï¸ è³½é“ç«‹é«”è·¯ç·šåœ–</h3>
        <img src="https://www.taipeicitymarathon.com/ck_imgs/%E7%AB%8B%E9%AB%94%E8%B7%AF%E7%B7%9A(%E5%85%A8%E7%A8%8B)_1111.jpg" alt="è‡ºåŒ—é¦¬æ‹‰æ¾ç«‹é«”è·¯ç·šåœ–" loading="lazy">
    </div>

    <div id="resultArea">
        <div class="summary-box">
            <strong>ğŸ¯ ç­–ç•¥ç¸½çµï¼š</strong> ç›®æ¨™å¹³å‡é…é€Ÿç‚º <span id="avgPace" style="font-weight:bold; color:var(--primary)">--:--</span> /kmã€‚
            <br>
            å‰æ®µ (0-20k) ç©©å®šå„²è“„ï¼Œä¸­æ®µ (20-26k) ç’°æ±æŠ—é¢¨é™é€Ÿï¼Œå¾Œæ®µ (30k+) æ²³æ¿±é †é¢¨è¿½åˆ†ã€‚
        </div>

        <h2>ğŸ“ åˆ†æ®µåŸ·è¡Œç­–ç•¥</h2>
        <div id="cardsContainer">
            <!-- Cards will be injected here -->
        </div>

        <div class="print-area-wrapper">
            <h3>ğŸ–¨ï¸ åˆ—å°è¨­å®š & æ‰‹ç’°é è¦½</h3>
            <p style="margin-bottom: 1rem; color: #666;">å®¢è£½åŒ–æ‚¨çš„é…é€Ÿæ‰‹ç’°ï¼š</p>
            
            <div class="custom-text-inputs">
                <input type="text" id="mantraInput" placeholder="çµ¦è‡ªå·±çš„è©± (å¿ƒéˆé›æ¹¯) - é è¨­ï¼šStart Slow. Finish Strong." oninput="updateWristbandText()">
                <textarea id="noteInput" placeholder="å‚™è¨» (Note) - æ”¯æ´å¤šè¡Œè¼¸å…¥ï¼Œä¾‹å¦‚ï¼š&#10;è¨˜å¾—åƒè† &#10;ä¿æŒå¾®ç¬‘" oninput="updateWristbandText()"></textarea>
            </div>
            
            <div class="print-controls">
                <label class="checkbox-label">
                    <input type="checkbox" id="checkKm" checked onchange="updateWristbandCols()">
                    é‡Œç¨‹ (KM)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="checkPhase" onchange="updateWristbandCols()">
                    ç­–ç•¥ (Phase)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="checkPace" checked onchange="updateWristbandCols()">
                    é…é€Ÿ (Pace)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="checkSeg" onchange="updateWristbandCols()">
                    åˆ†æ®µ (Split)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="checkTime" checked onchange="updateWristbandCols()">
                    æ™‚é–“ (Time)
                </label>
            </div>

            <!-- Full Font Settings -->
            <div class="font-settings-container">
                <div class="font-settings-title" onclick="toggleFontSettings()">ğŸ”½ å­—é«”å¤§å°å¾®èª¿ (é»æ“Šå±•é–‹/æ”¶åˆ)</div>
                <div class="font-settings-grid" id="fontSettingsGrid">
                    
                    <div class="font-control-item">
                        <label>é‡Œç¨‹ (KM)</label>
                        <div>
                            <input type="range" id="fsKm" min="8" max="18" value="11" oninput="updateAllFonts()">
                            <span id="valKm">11pt</span>
                        </div>
                    </div>
                    
                    <div class="font-control-item">
                        <label>ç­–ç•¥ (Phase)</label>
                        <div>
                            <input type="range" id="fsPhase" min="6" max="14" value="8" oninput="updateAllFonts()">
                            <span id="valPhase">8pt</span>
                        </div>
                    </div>

                    <div class="font-control-item">
                        <label>é…é€Ÿ (Pace)</label>
                        <div>
                            <input type="range" id="fsPace" min="10" max="24" value="14" oninput="updateAllFonts()">
                            <span id="valPace">14pt</span>
                        </div>
                    </div>

                    <div class="font-control-item">
                        <label>åˆ†æ®µ (Split)</label>
                        <div>
                            <input type="range" id="fsSeg" min="6" max="14" value="9" oninput="updateAllFonts()">
                            <span id="valSeg">9pt</span>
                        </div>
                    </div>

                    <div class="font-control-item">
                        <label>æ™‚é–“ (Time)</label>
                        <div>
                            <input type="range" id="fsTime" min="10" max="20" value="13" oninput="updateAllFonts()">
                            <span id="valTime">13pt</span>
                        </div>
                    </div>

                    <div class="font-control-item">
                        <label>çµ¦è‡ªå·±çš„è©± (Mantra)</label>
                        <div>
                            <input type="range" id="fsMantra" min="8" max="16" value="10" oninput="updateAllFonts()">
                            <span id="valMantra">10pt</span>
                        </div>
                    </div>

                    <div class="font-control-item">
                        <label>å‚™è¨» (Note)</label>
                        <div>
                            <input type="range" id="fsNote" min="8" max="16" value="9" oninput="updateAllFonts()">
                            <span id="valNote">9pt</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WYSIWYG Preview Container -->
            <div id="wristbandPreview" class="wristband-preview-container">
                <div id="wristband" class="wristband">
                    <div class="wb-header">TAIPEI MARATHON</div>
                    <div class="wb-goal">GOAL: <span id="wbGoalTime">3:29</span></div>
                    <table class="wb-table">
                        <thead>
                            <tr>
                                <th class="wb-km">KM</th>
                                <th class="wb-phase">PHASE</th>
                                <th class="wb-pace">PACE</th>
                                <th class="wb-seg">SPLIT</th>
                                <th class="wb-time">TIME</th>
                            </tr>
                        </thead>
                        <tbody id="wbTableBody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                    <div class="wb-footer">
                        GELS: 10k, 20k, 30k, 36k<br>
                        <span id="wbMantra" class="wb-custom-text">Start Slow. Finish Strong.</span>
                        <span id="wbNote" class="wb-note-text"></span>
                    </div>
                </div>
            </div>

            <button class="print-btn" onclick="window.print()">
                <span>åˆ—å°é…é€Ÿæ‰‹ç’°</span>
            </button>
        </div>

        <h3>ğŸ“Š è©³ç´°é…é€Ÿè¡¨</h3>
        <div class="table-container">
            <table id="detailTable">
                <thead>
                    <tr>
                        <th>é‡Œç¨‹</th>
                        <th>ç­–ç•¥éšæ®µ</th>
                        <th>å€æ®µç›®æ¨™é…é€Ÿ</th>
                        <th>åˆ†æ®µç”¨æ™‚</th>
                        <th>ç´¯ç©æ™‚é–“ (Gun Time)</th>
                    </tr>
                </thead>
                <tbody id="detailTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Constants based on the strategy document
    const STRATEGY_SEGMENTS = [
        { 
            endKm: 5, 
            name: "åŸå¸‚æš–æ©Ÿ", 
            type: "warmup", 
            paceMod: 1.025, // Slower
            desc: "äººå¤šæ“æ“ ï¼Œå£“åˆ¶è…ä¸Šè…ºç´ ã€‚é«”æ„Ÿè¦è¦ºå¾—ã€Œå¤ªæ…¢ã€ã€‚",
            mantra: "ã€Œèµ·è·‘æ…¢ä¸æ˜¯æå¤±ï¼Œæ˜¯æŠ•è³‡ã€‚ã€"
        },
        { 
            endKm: 10, 
            name: "å·¡èˆªæ¨¡å¼", 
            type: "normal", 
            paceMod: 0.99, // Slightly faster
            desc: "ä¸­å±±åŒ—è·¯æ—è”­å¤§é“ï¼Œåƒç¬¬1åŒ…è† (10K)ã€‚ç´¯ç©æ™‚é–“æœ¬éŒ¢ã€‚",
            mantra: "ã€Œç¾åœ¨çš„è¼•é¬†æ˜¯ç‚ºäº†30å…¬é‡Œå¾Œçš„å¼·æ‚ã€‚ã€"
        },
        { 
            endKm: 20, 
            name: "ç©©å®šå„²èƒ½", 
            type: "normal", 
            paceMod: 0.99, // Slightly faster
            desc: "æœ€èˆ’æœçš„è·¯æ®µã€‚20Kä¸Šç’°æ±å‰åƒç¬¬2åŒ…è† (å«å’–å•¡å› )ã€‚",
            mantra: "ã€Œå°ˆæ³¨ç•¶ä¸‹ï¼Œé€™ä¸€æ­¥ï¼Œå†ä¸€æ­¥ã€‚ã€"
        },
        { 
            endKm: 26, 
            name: "ç’°æ±æŠ—é¢¨", 
            type: "wind", 
            paceMod: 1.06, // Significantly slower (Wind + Uphill)
            desc: "é—œéµç”Ÿå­˜é»ï¼å¼·é€†é¢¨+çˆ¬å‡ã€‚èº²é›†åœ˜å¾Œï¼Œä¸è¦ç¡¬é ‚ï¼Œå…è¨±æ‰é€Ÿã€‚",
            mantra: "ã€Œæˆ‘æ˜¯çƒé¾œï¼Œæˆ‘æœ‰æ®¼ä¿è­·ã€‚ã€"
        },
        { 
            endKm: 30, 
            name: "è½‰æ›èª¿æ•´", 
            type: "normal", 
            paceMod: 1.00, // Recovery
            desc: "ä¸‹æ©‹åˆ©ç”¨é‡åŠ›åŠ é€Ÿï¼Œèª¿æ•´å‘¼å¸ã€‚30Kåƒç¬¬3åŒ…è† ã€‚",
            mantra: "ã€Œé‡‹æ”¾é‡åŠ›ï¼Œè®“åœ°çƒæ¨è‘—æˆ‘è·‘ã€‚ã€"
        },
        { 
            endKm: 36, 
            name: "æ²³æ¿±è¿½æ“Š", 
            type: "push", 
            paceMod: 0.97, // Fast (Tailwind)
            desc: "é †é¢¨æ‚¶ç†±ï¼Œè¿½åˆ†é»ƒé‡‘æ®µã€‚æ¯å€‹æ°´ç«™éƒ½è¦æ¾†æ°´é™æº«ï¼",
            mantra: "ã€Œé †é¢¨ä¹‹ç¥åœ¨æ¨æˆ‘ï¼Œç¾åœ¨é–‹å§‹åæ”»ã€‚ã€"
        },
        { 
            endKm: 42.195, 
            name: "æ„å¿—æ±ºæˆ°", 
            type: "push", 
            paceMod: 0.98, // Fast (All out)
            desc: "æ¢­å“ˆæ¨¡å¼ã€‚å¡”æ‚ è·¯çŸ­å¡å¾Œï¼Œå…¨é–‹ã€‚36Kåƒæœ€å¾Œä¸€åŒ…è† ã€‚",
            mantra: "ã€Œç—›ä»£è¡¨æˆ‘é‚„æ´»è‘—ï¼Œä¸Šå»å°±è´äº†ã€‚ã€"
        }
    ];

    function secondsToTimeStr(totalSec) {
        const roundedTotal = Math.round(totalSec);
        const h = Math.floor(roundedTotal / 3600);
        const m = Math.floor((roundedTotal % 3600) / 60);
        const s = Math.floor(roundedTotal % 60);
        return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function secondsToPaceStr(secPerKm) {
        const m = Math.floor(secPerKm / 60);
        const s = Math.round(secPerKm % 60);
        if (s === 60) {
            return `${m + 1}'00"`;
        }
        return `${m}'${s.toString().padStart(2, '0')}"`;
    }

    function updateWristbandCols() {
        const wb = document.getElementById('wristband');
        const showKm = document.getElementById('checkKm').checked;
        const showPhase = document.getElementById('checkPhase').checked;
        const showPace = document.getElementById('checkPace').checked;
        const showSeg = document.getElementById('checkSeg').checked;
        const showTime = document.getElementById('checkTime').checked;

        showKm ? wb.classList.remove('no-km') : wb.classList.add('no-km');
        showPhase ? wb.classList.remove('no-phase') : wb.classList.add('no-phase');
        showPace ? wb.classList.remove('no-pace') : wb.classList.add('no-pace');
        showSeg ? wb.classList.remove('no-seg') : wb.classList.add('no-seg');
        showTime ? wb.classList.remove('no-time') : wb.classList.add('no-time');
    }

    // Updated Function to update custom text
    function updateWristbandText() {
        const mantraInput = document.getElementById('mantraInput');
        const noteInput = document.getElementById('noteInput');
        
        const wbMantra = document.getElementById('wbMantra');
        const wbNote = document.getElementById('wbNote');

        // Logic: if empty string, don't show. If placeholder value needed, check value.
        // We use value directly. If user clears it, it should be empty.
        // But user asked for "Start Slow. Finish Strong" as a default.
        // We handle this by setting the default only if the INPUT is empty initially (on load).
        // If user manually clears it, we can respect that or revert to default. 
        // Let's implement logic: If value is empty string, hide element. 
        // If user wants default, they can type it or we set it on load.
        
        // Actually the prompt says: "Start Slow... can be a default value for the field".
        // It also says "Start Slow... is NOT required to print".
        // So:
        if (mantraInput.value.trim() === "") {
             wbMantra.innerText = "Start Slow. Finish Strong."; // Use as default placeholder text visually?
             // Or should we hide it? "not necessarily printed". 
             // Let's check if it's the INITIAL state or cleared state. 
             // To be safe and flexible: If empty, show nothing.
             wbMantra.style.display = 'none';
        } else {
             wbMantra.innerText = mantraInput.value;
             wbMantra.style.display = 'block';
        }

        if (noteInput.value.trim() === "") {
             wbNote.style.display = 'none';
        } else {
             wbNote.innerText = noteInput.value;
             wbNote.style.display = 'block';
        }
    }

    function toggleFontSettings() {
        const grid = document.getElementById('fontSettingsGrid');
        grid.classList.toggle('show');
    }
    
    // Unified Font Updater
    function updateAllFonts() {
        const fsKm = document.getElementById('fsKm').value;
        const fsPhase = document.getElementById('fsPhase').value;
        const fsPace = document.getElementById('fsPace').value;
        const fsSeg = document.getElementById('fsSeg').value;
        const fsTime = document.getElementById('fsTime').value;
        const fsMantra = document.getElementById('fsMantra').value;
        const fsNote = document.getElementById('fsNote').value;

        // Update displays
        document.getElementById('valKm').innerText = fsKm + 'pt';
        document.getElementById('valPhase').innerText = fsPhase + 'pt';
        document.getElementById('valPace').innerText = fsPace + 'pt';
        document.getElementById('valSeg').innerText = fsSeg + 'pt';
        document.getElementById('valTime').innerText = fsTime + 'pt';
        document.getElementById('valMantra').innerText = fsMantra + 'pt';
        document.getElementById('valNote').innerText = fsNote + 'pt';

        // Apply to Elements
        const wb = document.getElementById('wristband');
        
        // KM
        wb.querySelectorAll('.wb-km').forEach(el => el.style.fontSize = fsKm + 'pt');
        // Phase
        wb.querySelectorAll('.wb-phase').forEach(el => el.style.fontSize = fsPhase + 'pt');
        // Pace
        wb.querySelectorAll('.wb-pace').forEach(el => el.style.fontSize = fsPace + 'pt');
        // Split
        wb.querySelectorAll('.wb-seg').forEach(el => el.style.fontSize = fsSeg + 'pt');
        // Time
        wb.querySelectorAll('.wb-time').forEach(el => el.style.fontSize = fsTime + 'pt');
        // Footer texts
        document.getElementById('wbMantra').style.fontSize = fsMantra + 'pt';
        document.getElementById('wbNote').style.fontSize = fsNote + 'pt';
    }

    function calculateStrategy() {
        const hInput = document.getElementById('targetHours');
        const mInput = document.getElementById('targetMinutes');
        
        const h = parseInt(hInput.value) || 0;
        const m = parseInt(mInput.value) || 0;
        
        if (h === 0 && m === 0) return;

        const totalTargetSeconds = (h * 3600) + (m * 60);
        const avgPaceSeconds = totalTargetSeconds / 42.195;

        const timeDisplayStr = `${h}:${m.toString().padStart(2, '0')}`;

        document.getElementById('avgPace').textContent = secondsToPaceStr(avgPaceSeconds);
        document.getElementById('wbGoalTime').textContent = timeDisplayStr;

        let rawTotalTime = 0;
        let prevKm = 0;
        let segments = STRATEGY_SEGMENTS.map(seg => {
            const dist = seg.endKm - prevKm;
            const rawPace = avgPaceSeconds * seg.paceMod;
            const time = rawPace * dist;
            rawTotalTime += time;
            
            const segmentObj = {
                ...seg,
                startKm: prevKm,
                dist: dist,
                rawPace: rawPace
            };
            prevKm = seg.endKm;
            return segmentObj;
        });

        const correctionRatio = totalTargetSeconds / rawTotalTime;

        const cardsContainer = document.getElementById('cardsContainer');
        const detailBody = document.getElementById('detailTableBody');
        const wbBody = document.getElementById('wbTableBody');
        
        cardsContainer.innerHTML = '';
        detailBody.innerHTML = '';
        wbBody.innerHTML = '';

        let currentElapsedTime = 0;
        let lastWbTime = 0;
        
        const checkPoints = [5, 10, 15, 20, 25, 30, 35, 40, 42.195];
        let nextCpIdx = 0;

        segments.forEach(seg => {
            const finalPace = seg.rawPace * correctionRatio;
            const segTime = finalPace * seg.dist;
            
            const card = document.createElement('div');
            card.className = `card ${seg.type}`;
            card.innerHTML = `
                <div class="card-header">
                    <h3>${seg.startKm}K - ${seg.endKm}K: ${seg.name}</h3>
                    <span class="pace-badge">${secondsToPaceStr(finalPace)} /km</span>
                </div>
                <div class="instruction">ğŸ’¡ ${seg.desc}</div>
                <span class="mantra">${seg.mantra}</span>
            `;
            cardsContainer.appendChild(card);

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${seg.startKm} - ${seg.endKm} km</td>
                <td>${seg.name}</td>
                <td>${secondsToPaceStr(finalPace)}</td>
                <td>${secondsToTimeStr(segTime)}</td>
                <td>${secondsToTimeStr(currentElapsedTime + segTime)}</td>
            `;
            detailBody.appendChild(row);

            while (nextCpIdx < checkPoints.length && checkPoints[nextCpIdx] <= seg.endKm) {
                const cp = checkPoints[nextCpIdx];
                const distInSeg = cp - seg.startKm;
                const timeAtCp = currentElapsedTime + (distInSeg * finalPace);
                
                const splitTime = timeAtCp - lastWbTime;
                
                const wbRow = document.createElement('tr');
                if (cp === 42.195) wbRow.className = 'wb-highlight';
                
                wbRow.innerHTML = `
                    <td class="wb-km">${cp === 42.195 ? 'FINISH' : cp}</td>
                    <td class="wb-phase">${seg.name}</td>
                    <td class="wb-pace">${secondsToPaceStr(finalPace)}</td>
                    <td class="wb-seg">${secondsToTimeStr(splitTime)}</td>
                    <td class="wb-time">${secondsToTimeStr(timeAtCp)}</td>
                `;
                wbBody.appendChild(wbRow);
                
                lastWbTime = timeAtCp;
                nextCpIdx++;
            }

            currentElapsedTime += segTime;
        });

        document.getElementById('resultArea').style.display = 'block';
        updateWristbandCols();
        
        // Initialize Mantra with default text logic
        const mantraInput = document.getElementById('mantraInput');
        // Set the INPUT value to the default, so user sees it and can delete it.
        mantraInput.value = "Start Slow. Finish Strong."; 
        updateWristbandText();
        
        updateAllFonts(); // Init all font sizes
    }

    calculateStrategy();
</script>

</body>
</html>
